import 'dart:convert';

import 'package:news_app/model/articles.dart';
import 'package:test_api/test_api.dart';
import 'package:http/http.dart' as http;

void main() {
   test("parses topstories.json", () {
     const json_string =
         "[19826827,19826379,19825632,19827336,19826083,19825202,19826169,19825170,19825878,19818078,19824534,19823464,19827167,19826344,19818089,19822111,19816189,19822100,19824992,19825566,19825059,19822164,19824082,19821406,19816091,19816282,19818899,19804772,19825830,19819919,19825637,19826846,19822019,19826640,19825862,19825688,19817434,19822065,19823875,19826217,19823701,19803840,19804478,19815618,19818916,19821359,19817531,19823437,19817760,19819636,19826320,19817985,19823457,19823022,19817764,19813921,19825440,19826127,19818892,19824735,19818024,19818428,19817002,19821272,19814370,19824656,19810773,19822210,19823773,19822134,19813607,19824016,19806422,19799893,19823157,19821101,19805675,19819605,19819778,19816974,19813748,19819789,19806169,19810504,19825472,19813586,19802678,19820118,19820946,19805088,19819249,19818396,19820218,19801569,19817858,19818908,19817838,19824352,19800637,19811715,19810618,19810092,19808486,19810334,19812919,19804535,19800871,19816244,19813429,19819398,19823343,19817810,19819571,19805938,19819114,19812690,19818946,19821167,19806139,19819410,19809513,19811093,19824458,19805710,19825245,19818728,19811685,19811718,19811467,19807829,19813554,19812557,19819608,19811709,19817136,19813811,19806312,19815161,19806920,19821104,19816115,19808829,19824681,19813925,19802067,19813643,19824594,19810100,19807223,19808999,19823085,19801065,19821830,19805118,19814733,19819746,19811495,19802407,19802284,19807046,19808675,19815515,19812578,19805109,19803379,19807042,19820920,19807035,19815300,19818574,19811063,19818082,19811571,19814626,19815732,19822403,19810126,19810981,19813714,19813686,19822366,19800166,19822714,19819488,19802198,19807981,19807202,19823489,19811988,19808639,19821847,19800478,19806818,19819284,19807247,19804297,19810897,19818686,19820951,19819265,19799966,19812325,19814764,19806462,19804893,19817547,19822120,19801546,19809793,19819190,19800435,19815373,19815155,19821379,19800106,19800700,19801145,19824800,19823246,19801401,19801013,19815140,19804178,19806241,19819610,19813852,19813796,19810616,19817624,19800718,19806772,19824722,19816569,19803139,19800443,19804020,19820379,19806315,19813471,19802482,19822681,19818704,19817834,19816839,19817749,19815758,19809868,19809232,19825482,19822880,19804749,19819098,19815370,19803080,19807673,19809195,19823359,19803484,19822801,19818931,19802057,19806529,19806998,19816948,19808444,19805053,19810688,19814545,19819695,19800793,19824525,19808270,19819559,19821902,19810902,19799978,19806828,19805727,19811181,19821360,19802558,19813288,19815816,19808759,19813010,19819582,19802573,19806352,19811425,19807103,19807002,19802395,19803392,19809601,19820302,19809270,19803875,19814937,19808862,19808781,19801099,19821079,19817776,19812210,19820924,19822776,19813559,19816131,19806170,19820707,19813466,19810088,19820474,19822505,19817113,19812799,19814424,19806960,19804282,19813514,19816967,19822060,19813054,19815312,19821775,19810521,19810613,19817159,19808163,19818495,19801708,19820746,19804019,19820551,19815669,19806919,19813389,19802914,19802137,19814385,19809181,19817368,19803783,19810299,19819531,19815963,19809867,19813712,19811580,19816944,19805370,19814488,19805263,19805306,19816679,19804922,19807733,19815317,19799950,19811599,19813785,19815141,19812188,19803945,19816067,19812575,19817444,19802488,19804189,19815710,19815643,19817132,19808213,19813489,19801240,19800752,19821599,19813225,19813200,19800205,19799918,19813752,19812629,19814739,19813655,19813361,19814579,19805058,19814336,19810543,19814046,19809705,19805054,19805674,19813068,19808608,19807082,19810163,19801060,19814293,19808348,19801484,19812008,19806188,19811474,19800321,19810159,19810901,19810563,19802892,19809839,19814522,19814521,19814490,19800208,19814145,19808751,19813985,19803699,19813719,19813651,19813417,19813351,19811351,19807114,19801754,19801590,19806548,19804304,19804301,19811801,19806224,19802161,19811441,19806143,19815259,19811072,19811068,19811058,19811051,19810887,19805837,19809904,19809770,19802352,19821476,19805177,19805132,19809058,19805031,19808969,19805005,19808913,19808376,19808221,19804038,19804001,19806153,19802176,19801826,19801717,19801472,19801344,19805414,19800233,19803596,19803586,19803448,19803226,19814693,19811045,19802619,19814611,19802163,19801806,19801617,19801522,19805007,19800905,19800279,19800193,19816263,19809155,19814834,19808714,19817183,19826680,19811183,19806744,19801884,19816070,19823465,19816185,19815077,19814223,19815063,19817333,19817616,19808935]";
     expect(parseTopStories(json_string).first, 19826827);
   });

  test("parses items.json", () {
    const json_string =
        '{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8958,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}';
    expect(parseArticle(json_string).by, "dhouston");
  });

  test("parses items.json over a network", () async {
    final url = 'https://hacker-news.firebaseio.com/v0/topstories.json';
    final response = await http.get(url);
    if (response.statusCode == 200) {
      final idList = json.decode(response.body);
      if (idList.isNotEmpty) {
        final storyUrl =
            'https://hacker-news.firebaseio.com/v0/item/${idList.first}.json';
        final storyRes = await http.get(storyUrl);
        if (response.statusCode == 200) {
          expect(parseArticle(storyRes.body), isNotNull);
        }
      }
    }
  });
}
